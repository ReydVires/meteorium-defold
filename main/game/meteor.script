go.property("speed", 180)

local function set_angle(self)
	-- table store angle
	local tab_angle = {
		math.pi,
		math.pi / 1.5,
		math.pi / 2,
		math.pi / 4,
		math.pi * 2,
		math.pi / -4,
		math.pi / -2,
		math.pi / -1.5
	}
	local angle = math.random(1, #tab_angle)
	go.set_rotation(vmath.quat_rotation_z(tab_angle[angle]))
end

local function moving(self, dt)
	-- horizontal movement
	if self.pick_from == "left" or self.pick_from == "right" then
		if self.pick_from == "left" then
			self.pos.x = self.pos.x + self.speed * dt
		elseif self.pick_from == "right" then
			self.pos.x = self.pos.x - self.speed * dt
		end
		-- do diagonal movement when self.data_diagonal_x ~= "normal"
		if self.data_diagonal_x == "bot" then
			self.pos.y = self.pos.y - self.speed / 1.6 * dt
		elseif	self.data_diagonal_x == "top" then
			self.pos.y = self.pos.y + self.speed / 1.6 * dt
		end
	-- vertical movement
	elseif self.pick_from == "top" or self.pick_from == "bot" then
		if self.pick_from == "top" then
			self.pos.y = self.pos.y - self.speed * dt
		elseif self.pick_from == "bot" then
			self.pos.y = self.pos.y + self.speed * dt
		end
		-- do diagonal movement when self.data_diagonal_y ~= "normal"
		if self.data_diagonal_y == "left" then
			self.pos.x = self.pos.x - self.speed / 1.6 * dt
		elseif	self.data_diagonal_y == "right" then
			self.pos.x = self.pos.x + self.speed / 1.6 * dt
		end
	end
	go.set_position(self.pos)
end

local function destroy_area(self)
	if self.pos.x > 505 or self.pos.x < -25 then
		go.delete()
	elseif self.pos.y > 825 or self.pos.y < -25 then
		go.delete()
	end
end

function init(self)
	--print "meteor created"
	self.pos = go.get_position()
	local diagonal_y = {
		"left",
		"normal",
		"right",
		"normal"
	}
	local diagonal_x = {
		"top",
		"normal",
		"bot",
		"normal"
	}
	self.data_diagonal_y = diagonal_y[math.random(1,#diagonal_y)]
	self.data_diagonal_x = diagonal_x[math.random(1,#diagonal_x)]
	
	set_angle(self)
end

function update(self, dt)
	moving(self, dt)
	destroy_area(self)
end

function on_message(self, message_id, message, sender)
	-- from game.script
	if message_id == hash("set_move_dir") then
		self.pick_from = message.spawn_from
	end
end